/*
 * cdc_test.inc
 *
 *  Created: 05.01.2022 13:07:57
 *   Author: Dkoch83
 */ 
 .ifndef CDC_TEST_INCLUDE
.set CDC_TEST_INCLUDE = 1

CMD_CDC:		.db "cdc:",0x00,0x00
CMD_CDC_DSR:	.db "dsr:",0x00,0x00
CMD_CDC_RI:		.db "ri:",0x00
CMD_CDC_DCD:	.db "dcd:",0x00,0x00

CMD_CDC_ON:		.db "1",0x00
CMD_CDC_OFF:	.db "0",0x00



CMD_CDC_EXEC:
		; cdc:drs:[1/0]
		COMMAND_PGM_EXEC CMD_CDC_DSR, CMD_CDC_DSR_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_ECHO_EXEC_END

		; cdc:ri:[1/0]
		COMMAND_PGM_EXEC CMD_CDC_RI, CMD_CDC_RI_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_ECHO_EXEC_END

		; cdc:dcd:[1/0]
		COMMAND_PGM_EXEC CMD_CDC_DCD, CMD_CDC_DCD_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_ECHO_EXEC_END

CMD_CDC_EXEC_END:
RET
;#################################################################
CMD_CDC_DSR_EXEC:
		COMMAND_PGM_EXEC CMD_CDC_ON, CMD_CDC_DSR_ON_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_CDC_DSR_EXEC_END

		COMMAND_PGM_EXEC CMD_CDC_OFF, CMD_CDC_DSR_OFF_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_CDC_DSR_EXEC_END
CMD_CDC_DSR_EXEC_END:
RET

CMD_CDC_DSR_ON_EXEC:
	LDS R16, CDC_SERIAL_STATE
	SBR R16, CDC_DSR_bm
	STS CDC_SERIAL_STATE, R16
CMD_CDC_DSR_ON_EXEC_END:
RET

CMD_CDC_DSR_OFF_EXEC:
	LDS R16, CDC_SERIAL_STATE
	CBR R16, CDC_DSR_bm
	STS CDC_SERIAL_STATE, R16
CMD_CDC_DSR_OFF_EXEC_END:
RET
;#################################################################
CMD_CDC_RI_EXEC:
		COMMAND_PGM_EXEC CMD_CDC_ON, CMD_CDC_RI_ON_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_CDC_RI_EXEC_END

		COMMAND_PGM_EXEC CMD_CDC_OFF, CMD_CDC_RI_OFF_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_CDC_RI_EXEC_END
CMD_CDC_RI_EXEC_END:
RET

CMD_CDC_RI_ON_EXEC:
	LDS R16, CDC_SERIAL_STATE
	SBR R16, CDC_RI_bm
	STS CDC_SERIAL_STATE, R16
CMD_CDC_RI_ON_EXEC_END:
RET

CMD_CDC_RI_OFF_EXEC:
	LDS R16, CDC_SERIAL_STATE
	CBR R16, CDC_RI_bm
	STS CDC_SERIAL_STATE, R16
CMD_CDC_RI_OFF_EXEC_END:
RET
;#################################################################
CMD_CDC_DCD_EXEC:
		COMMAND_PGM_EXEC CMD_CDC_ON, CMD_CDC_DCD_ON_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_CDC_DCD_EXEC_END

		COMMAND_PGM_EXEC CMD_CDC_OFF, CMD_CDC_DCD_OFF_EXEC  ; (PGM_CMD_STRING_POINTER, FUNCTION_POINTER)
		SBRC R0, 0		
		RJMP CMD_CDC_DCD_EXEC_END
CMD_CDC_DCD_EXEC_END:
RET

CMD_CDC_DCD_ON_EXEC:
	LDS R16, CDC_SERIAL_STATE
	SBR R16, CDC_DCD_bm
	STS CDC_SERIAL_STATE, R16
CMD_CDC_DCD_ON_EXEC_END:
RET

CMD_CDC_DCD_OFF_EXEC:
	LDS R16, CDC_SERIAL_STATE
	CBR R16, CDC_DCD_bm
	STS CDC_SERIAL_STATE, R16
CMD_CDC_DCD_OFF_EXEC_END:
RET
;#################################################################
.endif ;CDC_TEST_INCLUDE